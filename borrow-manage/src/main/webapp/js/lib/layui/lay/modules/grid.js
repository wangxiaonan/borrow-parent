/** layui-v1.0.0 MIT License By http://www.layui.com */
 ;layui.define(["form","laytpl","laypage"],function(exports){var form=layui.form(),Grid={config:{render:function(e,i){var d=document.getElementById(e).innerHTML;return layui.laytpl(d).render(i)||""},token:""},createNew:function(option){function fnFreeze(){}function fnData(e){if(grid.loading(),grid.data){var i=$.extend(!0,{},grid.data);if(GRIDORDER.length>0&&i.rows.sort(function(e,i){for(var d=0,r=GRIDORDER.length;r>0;r--){var t=e[GRIDORDER[r-1].code],n=i[GRIDORDER[r-1].code];if(t!=n){d=(t>n?1:-1)*("asc"==GRIDORDER[r-1].asc?1:-1);break}d=0}return d}),grid.pageSize){grid.total=grid.data.rows.length;var d=$.extend(!0,{},i);d.rows=d.rows.slice(grid.pageSize*(grid.page-1),grid.pageSize*grid.page),grid.pageData=d}else grid.pageData=i;grid.flag=!0,grid.dataSuccess&&grid.dataSuccess(grid.pageData),e()}else if(grid.url){var r=grid.url;if(grid.pageSize&&(grid.searchData.page=grid.page,grid.searchData.pageSize=grid.pageSize),GRIDORDER.length>0){var t="";$.each(GRIDORDER,function(e,i){t+=i.code+" "+i.asc+","}),t=t.substr(0,t.length-1),grid.searchData.orderString=t}$.ajax({url:r,data:grid.searchData,type:"get",dataType:"json",beforeSend:function(e){CONFIG.token&&e.setRequestHeader("Authorization","Basic "+CONFIG.token)},success:function(i){grid.pageData=i,grid.flag=i.flag,grid.total=i.total,grid.dataSuccess&&grid.dataSuccess(i),e()},error:function(i){grid.flag=!1,e()}})}else grid.pageData={rows:[]},e()}function fnSuccess(){grid.elem.html("");var e=$('<div class="grid-content"></div>').appendTo(grid.elem),i=CONFIG.render(grid.view,grid.pageData);fnHeader(i,e),fnBody(i,e),grid.success&&grid.success(grid.pageData,grid.elem),setTimeout(function(){grid.resize()},100),setTimeout(function(){grid.resize()},200),$(window).resize(function(){grid.elem.parents("div.layui-tab-item").length>0?grid.elem.parents("div.layui-tab-item").hasClass("layui-show")&&grid.resize():grid.resize()})}function fnHeader(e,i){var d=i.find(".grid-head");0==d.length&&(d=$('<div class="grid-head"></div>').appendTo(i)),d.html(e),d.find(">table").nextAll().remove(),d.find("thead").siblings().empty(),d.find("thead th,thead td").each(function(e){var i=$(this);i.html('<div class="grid-coll">'+i.html()+"</div>"),"undefined"!=typeof i.attr("order")&&i.on("click",events.order).find(".grid-coll").append('<i class="grid-order"></i>'),0==e&&i.find(":checkbox").length>0&&!grid.singleSelect&&i.find(":checkbox").on("click",events.selectAll)})}function fnBody(e,i){if(!grid.flag)return i.addClass("grid-err").html("获取数据失败"),void grid.closeLoading();var d=i.find(".grid-head").find("table"),r=i.find(".grid-body");0==r.length&&(r=$('<div class="grid-body"></div>').appendTo(i)),r.html(e),r.find(">table").prevAll().remove(),r.find("thead th,thead td").each(function(){var e=$(this);e.html('<div class="grid-coll">'+e.html()+"</div>"),"undefined"!=typeof e.attr("order")&&e.find(".grid-coll").append('<i class="grid-order"></i>')}),0==r.find("tbody tr").length&&r.find("tbody").append('<tr><td style="border:none"></td></tr>');var t=r.find(">.grid-tool").remove();grid.elem.find(".grid-page").remove();var n=$('<div class="grid-page"><div></div></div>'),o=Math.ceil(grid.total/grid.pageSize);(o>1||t.length>0)&&(n.appendTo(i),t.prependTo(n)),o>1&&layui.laypage({record:grid.record?grid.total:0,cont:n.find(">div"),pages:o,curr:grid.page,groups:grid.pageGroup,skip:!0,first:1,last:o,prev:"<em><</em>",next:"<em>></em>",jump:function(e,i){i||(grid.page=e.curr,fnData(function(){fnBody(CONFIG.render(grid.view,grid.pageData),grid.elem.find(".grid-content"))}))}});var a=r.find("tbody tr");if(a.length>0){d.find("th").first().find(":checkbox");a.on("click",events.rowClick)}r.scroll(function(){RESIZE={left:$(this).scrollLeft(),top:$(this).scrollTop()},d.css("margin-left",-RESIZE.left)}),grid.closeLoading(),grid.resize()}function rowsDom(e,i){"[object Array]"!=Object.prototype.toString.call(e)&&(e=[e]);var d=CONFIG.render(grid.view,{rows:e,op:i}),r=$(d).find("tbody tr");return r.on("click",events.rowClick),r}function verify(e){var i,d=!0,r="",t=form.config.verify;return e.find("*[lay-verify]").each(function(){var e=$(this),n=e.parents("td").last(),o=e.attr("lay-verify").split("|"),a="",s=e.val();$.each(o,function(o,g){var c="function"==typeof t[g];t[g]&&(c?a=t[g](s,e[0]):!t[g][0].test(s))&&(n.addClass(CSS.danger),d=!1,""==r&&(r=a||t[g][1]),i||(i=e))}),$(this).on("keyup",function(){n.removeClass(CSS.danger)})}),d||(layer.msg(r,{icon:5,shift:6}),i.select()),d}var GRIDORDER=[],RESIZE={left:0,top:0},CONFIG=this.config,CSS={danger:"grid-danger"},grid={elem:"string"==typeof option.elem?$("#"+option.elem):option.elem,view:option.view,data:option.data,pageData:null,url:option.url,page:option.page||1,pageSize:option.pageSize,pageGroup:void 0==option.pageGroup?5:option.pageGroup,search:option.search,searchData:option.searchData||[],html:"",flag:!0,message:"",total:0,record:option.record||!1,freeze:option.freeze,singleSelect:option.singleSelect||!1,success:option.success,rowClick:option.rowClick,rowid:option.rowid,dataSuccess:option.dataSuccess};grid.build=function(){fnData(fnSuccess)};var events={rowClick:function(){var e=$(this);e.hasClass("selected")?(grid.singleSelect||(e.removeClass("selected"),e.find("td:first :checkbox").length>0&&(e.find("td:first :checkbox")[0].checked=!1)),grid.elem.find(".grid-head").find("th,td").first().find(":checkbox").length>0&&(grid.elem.find(".grid-head").find("th,td").first().find(":checkbox")[0].checked=!1)):(e.addClass("selected"),e.find("td:first :checkbox").length>0&&(e.find("td:first :checkbox")[0].checked=!0,e.find("td:first :checkbox").on("click",function(){e[0].checked=!0})),grid.singleSelect&&e.siblings().removeClass("selected").each(function(){$(this).find("td:first :checkbox").length>0&&($(this).find("td:first :checkbox")[0].checked=!1)})),grid.rowClick&&grid.rowClick(grid.pageData.rows[e.index()]),e.addClass("focus"),e.siblings().removeClass("focus")},order:function(){var e=$(this),i=e.find(".grid-order"),d=e.attr("order");i.hasClass("grid-order-asc")?(i.removeClass("grid-order-asc").addClass("grid-order-desc"),$.each(GRIDORDER,function(e,i){if(i.code==d)return GRIDORDER.splice(e,1),!1}),GRIDORDER.push({code:d,asc:"desc"})):i.hasClass("grid-order-desc")?(i.removeClass("grid-order-desc"),$.each(GRIDORDER,function(e,i){if(i.code==d)return GRIDORDER.splice(e,1),!1})):(i.addClass("grid-order-asc"),$.each(GRIDORDER,function(e,i){if(i.code==d)return GRIDORDER.splice(e,1),!1}),GRIDORDER.push({code:d,asc:"asc"})),fnData(function(){fnBody(CONFIG.render(grid.view,grid.pageData),grid.elem.find(".grid-content"))})},selectAll:function(){var e=$(this),i=e[0].checked,d=grid.elem.find(".grid-body tbody tr");i?d.addClass("selected"):d.removeClass("selected"),d.each(function(){$(this).find("td:first :checkbox").length>0&&($(this).find("td:first :checkbox")[0].checked=i)})}};return grid.loading=function(){var e=grid.elem.find(".loading_bg,.loading");0==e.length&&(e=$('<div class="loading_bg"></div><div class="loading"><i class="layui-icon layui-anim layui-anim-rotate layui-anim-loop">&#xe63d;</i></div>').appendTo(grid.elem)),e.show()},grid.closeLoading=function(){grid.elem.find(".loading_bg,.loading").hide()},grid.getIndex=function(){var e=this.elem.find(".grid-body tbody tr.focus");return e.length>0?e.index():-1},grid.getRow=function(){var e=grid.getIndex();return e>=0?grid.pageData.rows[e]:null},grid.focus=function(e){if(void 0==e||e==-1)grid.elem.find(".grid-body tbody tr.focus").removeClass("focus");else{var i=grid.elem.find(".grid-body tbody tr:eq("+e+")").addClass("focus");i.siblings(".focus").removeClass("focus"),grid.singleSelect?grid.selectIndex(e):(i.addClass("selected"),i.find("td:first :checkbox").length>0&&(i.find("td:first :checkbox")[0].checked=!0))}},grid.selectValue=function(e){var i=this.rowid;if(void 0==e){var d=this.selectRow();return null==d?null:this.singleSelect?d[i]:(values=[],$.each(d,function(e,d){values.push(d[i])}),values)}this.singleSelect&&(e=[e]),this.elem.find("tbody tr.selected").each(function(){$(this).removeClass("selected"),$(this).find("td:first :checkbox").length>0&&($(this).find("td:first :checkbox")[0].checked=!1)}),$.each(grid.pageData.rows,function(d,r){if(e.indexOf(r[i])!=-1){var t=grid.elem.find("tbody tr:eq("+d+")");t.addClass("selected"),t.find("td:first :checkbox").length>0&&(t.find("td:first :checkbox")[0].checked=!0)}})},grid.selectRow=function(){if(grid.singleSelect){var e=this.elem.find(".grid-body tbody tr.selected");return e.length>0?grid.pageData.rows[e.index()]:null}return rows=[],this.elem.find(".grid-body tbody tr").each(function(e){$(this).hasClass("selected")&&rows.push(grid.pageData.rows[e])}),rows.length>0?rows:null},grid.selectIndex=function(e){if(void 0!=e&&e>=0)if(grid.elem.find(".grid-body tbody tr.selected").removeClass("selected").each(function(){$(this).find("td:first :checkbox").length>0&&($(this).find("td:first :checkbox")[0].checked=!1)}),"[object Array]"!=Object.prototype.toString.call(e)||grid.singleSelect){var i=grid.elem.find(".grid-body tbody tr:eq("+e+")");i.addClass("selected"),i.find("td:first :checkbox").length>0&&(i.find("td:first :checkbox")[0].checked=!0)}else $.each(e,function(e,i){var d=grid.elem.find(".grid-body tbody tr:eq("+i+")");return d.addClass("selected"),d.find("td:first :checkbox").length>0&&(d.find("td:first :checkbox")[0].checked=!0),!1});else if(void 0==e){if(grid.singleSelect){var i=this.elem.find(".grid-body tbody tr.selected");return i.length>0?i.index():-1}return rows=[],this.elem.find(".grid-body tbody tr").each(function(e){$(this).hasClass("selected")&&rows.push(e)}),rows.length>0?rows:null}},grid.insert=function(rows,index){if("[object Array]"!=Object.prototype.toString.call(rows)&&(rows=[rows]),void 0==index||index<0)$.each(rows,function(e,i){grid.pageData.rows.push(i)});else{var str=JSON.stringify(rows);str=str.substr(1,str.length-2),0==index?eval("grid.pageData.rows.unshift("+str+")"):eval("grid.pageData.rows.splice("+index+",0,"+str+")")}var trs=rowsDom(rows),tbody=grid.elem.find(".grid-body tbody");return void 0==index||index<0?tbody.append(trs):0==index?tbody.prepend(trs):tbody.find(">tr:eq("+index+")").before(trs),grid.resize(),trs},grid.update=function(e,i){if(void 0==i||i<0)return void console.log("grid error: index参数错误");grid.pageData.rows[i]=e;var d=rowsDom(e);return grid.elem.find(".grid-body tbody").find(">tr:eq("+i+")").replaceWith(d),grid.resize(),grid.focus(i),d},grid["delete"]=function(e){if(void 0==e)return void console.log("grid error:index参数错误");"[object Array]"!=Object.prototype.toString.call(e)&&(e=[e]);for(var i=e.length;i>0;i--)grid.pageData.rows.splice(e[i-1],1),grid.elem.find(".grid-body tbody").find(">tr:eq("+e[i-1]+")").remove();grid.resize()},grid.foot=function(e){var i=CONFIG.render(grid.view,e),d=$(i).find("tfoot");grid.elem.find(".grid-body tfoot").replaceWith(d),grid.resize()},grid.edit=function(e){var i=grid.elem.find(".grid-body tbody");if(void 0==e||e<0){var d=rowsDom(grid.pageData.rows,"edit");i.html(d)}else{var r=grid.pageData.rows[e],d=rowsDom(r,"edit");i.find(">tr:eq("+e+")").replaceWith(d),grid.focus(e)}grid.resize()},grid.endEdit=function(e){var i=grid.elem.find(".grid-body tbody"),d=null;if(void 0==e||e<0){if(verify(i)){i.find("tr").each(function(e,i){$(i).find("*[name]").each(function(i,d){grid.pageData.rows[e][$(d).attr("name")]=d.value})}),d=grid.pageData.rows;var r=rowsDom(d);i.html(r)}}else{var t=i.find("tr:eq("+e+")");if(verify(t)){t.find("*[name]").each(function(i,d){grid.pageData.rows[e][$(d).attr("name")]=d.value}),d=grid.pageData.rows[e];var r=rowsDom(d);i.find(">tr:eq("+e+")").replaceWith(r),grid.focus(e)}}return grid.resize(),d},grid.clear=function(){grid.data={rows:[]},grid.build()},grid.setData=function(e){grid.data=e,grid.page=1,grid.build()},grid.resize=function(){var e=grid.elem.find(".grid-head>table"),i=grid.elem.find(".grid-body>table"),d=grid.elem.find(".grid-head th,.grid-head td"),r=grid.elem.find(".grid-body thead th,.grid-body thead td");if(e.css("width",i.width()),r.each(function(e,i){var r=$(i).find(".grid-coll").width();$(d[e]).find(".grid-coll").css("width",r)}),grid.elem.hasClass("grid")){var t=grid.elem.find(".grid-head").height()||0,n=grid.elem.find(".grid-page").height()||0;grid.elem.find(".grid-body").css({top:t,bottom:n}),grid.elem.find(".grid-body table").height()<grid.elem.find(".grid-body").height()&&grid.elem.find(".grid-body").css({bottom:"auto"});var o=0,a=grid.elem.prevAll(".grid-position");0==a.length&&(a=grid.elem.prev()),a.length>0&&(o=a.height()+a.position().top+5,grid.elem.css("top",o))}var s=grid.elem.find(".grid-body table:first thead").height()+1||0;s>0&&grid.elem.find(".grid-body table:first").css("margin-top",-s),0!=RESIZE.top&&grid.elem.find(".grid-body").scrollTop(RESIZE.top),0!=RESIZE.left&&grid.elem.find(".grid-body").scrollLeft(RESIZE.left)},grid.search&&form.on("submit("+grid.search+")",function(e){grid.page=1,grid.searchData=e.field,grid.build()}),grid}};layui.addcss("modules/grid/grid.css",function(){},"gridcss"),exports("grid",Grid)});